/*!
 * World JS: Evolution Simulator
 * https://github.com/anvoz/world-js
 *
 * Version 2.0
 *
 * Copyright (c) 2013 An Vo - anvo4888@gmail.com
 * Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php
 */

!function(a){"use strict";var c=a.document,d=function(){return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(b){a.setTimeout(function(){b(+new Date)},1e3/60)}}(),e=a.WorldJS=function(){var a=this;a.running=!1,a.stopCallback=function(){},a.width=640,a.height=360,a.padding=10,a.canvas={wrapper:!1,context:!1},a.sprite={src:"images/seeds.png",image:!1},a.nextSeedId=1,a.maxSafeSeedsForDisplay=3e4,a.tickPerYear=60,a.tickMod=0,a.distributedTicks=[];for(var b=0;b<a.tickPerYear-1;b++)a.distributedTicks.push(0);a.lastTickTime=0,a.fps=0,a.Tile=new e.Tile,a.Knowledge=new e.Knowledge,a.Statistic=new e.Statistic,a.Rules=new e.Rules,a.yearPassedCallback=function(){}};e.prototype.init=function(a){var b=this,d=c.createElement("canvas"),e=b.canvas.wrapper=c.getElementById(a),f=b.width=d.width=e.clientWidth||b.width,g=b.height=d.height=e.clientHeight||b.height;e.appendChild(d),b.canvas.context=d.getContext("2d");var h=new Image;return h.src=b.sprite.src,b.sprite.image=h,b.Tile.init(b,f,g),b},e.prototype.add=function(a,b){var c=this,d=new a(b);d.world=c,d.id=c.nextSeedId++,d.age=b.age||0,d.age>0&&(d.tickCount=d.age*c.tickPerYear),d.tickMod=c.tickMod,d.IQ+=c.Rules.baseIQ;var e=function(a,b){return Math.floor(Math.random()*(b-a+1)+a)};d.x===!1&&(d.x=e(0,c.width-1-Math.max(d.appearance.width,c.padding))),d.y===!1&&(d.y=e(0,c.height-1-d.appearance.height-c.padding)),d.tileIndex=c.Tile.getIndex(d),c.Tile.set(d);for(var f=c.distributedTicks,g=0,h=f[g],i=0,j=f.length;j>i;i++)f[i]<h&&(g=i,h=f[i]);return f[g]++,d.tickIndex=g,d.tickCount+=(c.tickMod+d.tickCount+g)%d.actionInterval,d.stepCount=d.tickCount,c.Statistic.seedAdded(d),c},e.prototype.remove=function(a){var b=this;return b.Statistic.seedRemoved(a),a.married&&(a.married=!1,a.relationSeed.married=!1,a.relationSeed.relationSeed=!1,a.relationSeed=!1),b.Tile.rem(a),b.distributedTicks[a.tickIndex]--,b},e.prototype.addRandomPeople=function(a,b,c,d){var e=this,f=e.tickPerYear,g=function(a,b){return Math.floor(Math.random()*(b-a+1)+a)};b="undefined"==typeof b?15:b,c="undefined"==typeof c?20:c,d="undefined"==typeof d?0:d;for(var h=0;a>h;h++){var i=g(b,c),j={age:i,tickCount:i*f};if(d>0){var k=5==d?g(1,4):d,l=10;switch(k){case 1:j.y=g(0,l);break;case 2:j.y=g(e.height-l-1,e.height-1);break;case 3:j.x=g(0,l);break;case 4:j.x=g(e.width-l-1,e.width-1)}}a/2>h?e.add(e.Male,j):e.add(e.Female,j)}return e},e.prototype.run=function(a){var b=this,c=b.Statistic,e=b.canvas.context,f=b.sprite.image;b.tickMod=++b.tickMod%b.tickPerYear;var g=0===b.tickMod,h=c.population<=b.maxSafeSeedsForDisplay||g;h&&e.clearRect(0,0,b.width,b.height);for(var i=b.Tile.list,j=b.Tile.maxDisplayedSeeds,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=i.length;s>r;r++)for(var t=i[r],u=0,v=0,w=t.length;w>v;v++)if(t[v]){var x=t[v],y=x.tileIndex;if(x.tickMod==b.tickMod)continue;x.tickMod=b.tickMod,g&&(x.age++,k++,l+=x.IQ,x instanceof b.Male?x.age<=x.maxChildAge?o++:(m++,x.married&&q++):x.age<=x.maxChildAge?p++:n++),h&&j>u&&(x.draw(e,f),u++),x.tick();var z=b.Tile.getIndex(x);z!==y&&(b.Tile.rem(x),x.tileIndex=z,b.Tile.set(x))}return g&&(c.yearPassed({population:k,IQ:l,men:m,women:n,boys:o,girls:p,families:q}),b.Rules.change(b),b.Knowledge.gain(b),setTimeout(function(){b.yearPassedCallback.call(b)},1),0===k)?(b.running=!1,void 0):(b.running?(b.fps=1e3/(a-b.lastTickTime),b.lastTickTime=a,d(b.run.bind(b))):(b.stopCallback.call(b),b.stopCallback=function(){}),b)},e.prototype.start=function(){this.running=!0,this.run()},e.prototype.stop=function(a){this.running=!1,"function"==typeof a&&(this.stopCallback=a)}}(window),function(a){"use strict";var d,c=a.WorldJS;d=c.Tile=function(){var a=this;a.list=[],a.availableArrayIndexes=[],a.size=20,a.maxDisplayedSeeds=7,a.totalTiles=!1,a.tilesPerRow=!1,a.tilesPerCol=!1},d.prototype.init=function(a,b,c){var d=a.Tile,e=d.size,f=Math.ceil(b/e)*Math.ceil(c/e);d.totalTiles=f,d.tilesPerRow=Math.ceil(b/e),d.tilesPerCol=Math.ceil(c/e);for(var g=d.list,h=d.availableArrayIndexes,i=0;f>i;i++)g.push([]),h.push([])},d.prototype.getIndex=function(a){return Math.floor(a.x/this.size)+Math.floor(a.y/this.size)*this.tilesPerRow},d.prototype.set=function(a){var b=this,c=b.list[a.tileIndex],d=b.availableArrayIndexes[a.tileIndex];d.length>0?(a.tileArrayIndex=d.pop(),c[a.tileArrayIndex]=a):(a.tileArrayIndex=c.length,c.push(a))},d.prototype.rem=function(a){var b=this;b.list[a.tileIndex][a.tileArrayIndex]=!1,b.availableArrayIndexes[a.tileIndex].push(a.tileArrayIndex)}}(window),function(a){"use strict";var d,c=a.WorldJS;d=c.Knowledge=function(){var a=this;a.list={},a.trending=[],a.trendingAdded=function(){},a.trendingRemoved=function(){},a.completed=[]},d.prototype.gain=function(a){for(var b=this,c=a.Statistic.year,d=a.Statistic.IQ,e=[],f=0,g=0,h=b.trending.length;h>=g;g++){if(e[g]=Math.floor(101*Math.random()),h>g){var i=b.list[b.trending[g]];1!=i.IQ.priority&&(e[g]*=i.IQ.priority)}f+=e[g]}for(var j={.1:.01,1:.05,2:.1},k=[],l=[],m=[],g=0,h=b.trending.length;h>g;g++){var i=b.list[b.trending[g]],n=d*e[g]/f,o=i.IQ.gained;o+=Math.floor(Math.min(i.IQ.required*j[i.IQ.priority],n)),isNaN(o)&&(o=i.IQ.gained),o>=i.IQ.required?(i.IQ.gained=i.IQ.required,l.push.apply(l,i.following),i.affectedYear=c,i.onAffected(a),m.push(i)):(i.IQ.gained=o,k.push(i.id))}if(m.length>0){for(var g=0;g<m.length;g++)b.trendingRemoved(m[g]),b.completed.push(m[g]);for(var g=0;g<l.length;g++)b.trendingAdded(b.list[l[g]]),k.push(l[g]);b.trending=k}}}(window),function(a){"use strict";var d,c=a.WorldJS;d=c.Statistic=function(){var a=this;a.year=0,a.food=0,a.foodResource=100,a.population=0,a.IQ=0,a.men=0,a.women=0,a.boys=0,a.girls=0,a.families=0,a.maxIQ=0,a.yearMaxIQ=0,a.maxAge=0,a.yearMaxAge=0,a.die=0,a.sumAge=0,a.dieMarriedFemale=0,a.sumChildren=0},d.prototype.seedAdded=function(a){var b=this;a.IQ>b.maxIQ&&(b.maxIQ=a.IQ,b.yearMaxIQ=b.year)},d.prototype.seedRemoved=function(a){var b=this;b.die++;var c=a.age;c>b.maxAge&&(b.maxAge=c,b.yearMaxAge=b.year),b.sumAge+=c,"undefined"!=typeof a.totalChildren&&(b.dieMarriedFemale++,b.sumChildren+=a.totalChildren)},d.prototype.yearPassed=function(a){var b=this;b.year++,b.population=a.population,b.IQ=a.IQ,b.men=a.men,b.women=a.women,b.boys=a.boys,b.girls=a.girls,b.families=a.families}}(window),function(a){"use strict";var d,c=a.WorldJS;d=c.Rules=function(){var a=this;a.Population={limit:100},a.baseIQ=0,a.Chance={death:0,marriage:0,childbirth:0},a.ChanceIncr={death:0,marriage:0,childbirth:0},a.Food={adult:1,child:-1,resourceIncr:0,min:-1e4},a.Famine={deathChanceIncr:.1,unit:-100},a.FoodSpoilage={foodDecr:.9,interval:1},a.LargeCooperation={deathChanceIncr:.1,unit:1}},d.prototype.change=function(a){var b=a.Rules,c=a.Statistic,d=c.food,e=c.foodResource,f=c.population,g=c.men+c.women,h=c.boys+c.girls;e>0&&(e=Math.max(0,e+Math.ceil(e*b.Food.resourceIncr)));var i=Math.min(e,g*b.Food.adult),j=h*b.Food.child,k=i+j;e=Math.max(0,e-i),d+=k,d<b.Food.min&&(d=b.Food.min);var l=0;if(d<=b.Famine.unit){var m=Math.floor(d/b.Famine.unit);l+=m*b.Famine.deathChanceIncr}if(0===c.year%b.FoodSpoilage.interval&&d>0&&(d-=Math.floor(d*b.FoodSpoilage.foodDecr)),f>b.Population.limit){var m=f-b.Population.limit;l+=m*b.LargeCooperation.deathChanceIncr}c.food=d,c.foodResource=e,b.Chance.death=l+b.ChanceIncr.death}}(window),function(a){"use strict";var d,c=a.WorldJS;d=c.prototype.Seed=function(a){var b=this;b.world=!1,b.id=!1,b.tileIndex=!1,b.tickIndex=!1,b.tickMod=!1,b.age=a.age||0,b.x="undefined"==typeof a.x?!1:a.x,b.y="undefined"==typeof a.y?!1:a.y,b.appearance=a.appearance||!1,b.relationSeed=a.relationSeed||!1,b.tickCount=a.tickCount||0,b.actionInterval=a.actionInterval||30,b.stepCount=b.tickCount,b.jumpInterval=20,b.moveUntilStep=a.moveUntilStep||b.tickCount+Math.floor(21*Math.random()+10)*b.jumpInterval,b.ageToMoveAgain=0,b.moveTo=a.moveTo||!1},d.prototype.draw=function(a,b){var c=this;if(c.appearance===!1)a.fillRect(c.x,c.y,10,10);else{var d=c.age<=c.maxChildAge?c.appearance.child:c.appearance,e=c.jumpInterval,f=10,g=c.stepCount%e,h=f>g?g+1:f-g%f-1;a.drawImage(b,d.x,d.y,d.width,d.height,c.x,c.y-h,d.width,d.height)}},d.prototype.move=function(a){var b=this,c=function(a,b){return Math.floor(Math.random()*(b-a+1)+a)};if(a)a.call(b);else{if(b.stepCount==b.moveUntilStep){if(0==b.ageToMoveAgain||b.ageToMoveAgain>b.age)return 0==b.ageToMoveAgain&&(b.ageToMoveAgain=b.age+c(2,10)),void 0;b.ageToMoveAgain=0,b.moveUntilStep=b.stepCount+c(10,50)*b.jumpInterval}if(b.moveTo===!1||b.moveTo.x===b.x&&b.moveTo.y===b.y){var d=b.world;b.moveTo={x:c(0,d.width-1-Math.max(b.appearance.width,d.padding)),y:c(d.padding,d.height-1-b.appearance.height-d.padding)}}}b.stepCount++,b.x<b.moveTo.x?b.x++:b.x>b.moveTo.x&&b.x--,b.y<b.moveTo.y?b.y++:b.y>b.moveTo.y&&b.y--},d.prototype.seek=function(a){var b=this,c=b.world.Tile,d=[[0,0],[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]];a||(a=function(a){return a.id!=b.id});for(var e=c.tilesPerRow,f=c.tilesPerCol,g=0,h=d.length;h>g;g++){var i;if(0===g)i=b.tileIndex;else{var j=b.tileIndex%e+d[g][0],k=Math.floor(b.tileIndex/e)+d[g][1];if(!(j>=0&&e>j&&k>=0&&f>k))continue;i=j+k*e}for(var l=c.list[i],m=0,n=l.length;n>m;m++)if(l[m]&&b.id!=l[m].id){var o=l[m];if(a.call(b,o))return o}}return!1},d.prototype.tick=function(){var a=this;a.tickCount++,a.move()},d.prototype.getChance=function(a,b){for(var c=a.world,d=a.chances[b],e=a.age,f=0,g=0,h=0,i=0;d[f]&&e>d[f].range[0];){var j=d[f];g=j.range[0],h=j.from,i=(j.to-j.from)/(j.range[1]-j.range[0]),f++}var k=h+(e-g)*i;return 0!=c.Rules.Chance[b]&&(k+=k*c.Rules.Chance[b]),k}}(window),function(a){"use strict";var e,c=a.WorldJS,d=c.prototype.Seed;e=c.prototype.Male=function(a){var b=this;a.appearance={x:0,y:0,width:13,height:20,child:{x:26,y:0,width:11,height:10}},d.call(b,a),b.IQ=(a.IQ||0)+Math.floor(4*Math.random()),b.maxChildAge=15,b.married=!1,b.chances=a.chances||{death:[{range:[1,20],from:.02,to:.01},{range:[20,60],from:.01,to:.02},{range:[60,80],from:.02,to:.05},{range:[80,100],from:.05,to:.9}],marriage:[{range:[15,30],from:.1,to:.5},{range:[30,50],from:.5,to:.1},{range:[50,80],from:.1,to:.01}]}},e.prototype=Object.create(d.prototype),e.prototype.contructor=e,e.prototype.tick=function(){var a=this;a.tickCount++;var b=a.actionInterval;if(a.tickCount%b===b-1){var c=a.world,d=a.getChance(a,"death");if(d>0&&Math.random()<d)return c.remove(a),void 0;if(!a.married&&a.age>=a.chances.marriage[0].range[0]){var e=a.getChance(a,"marriage");if(e>0){var f=Math.random();if(e>f){var g=a.seek(function(b){return b instanceof c.Female&&!b.married&&b.age>=b.chances.childbirth[0].range[0]&&(b.age<=a.age||f*Math.ceil((b.age-a.age)/10)<e)});g!==!1&&(a.married=!0,g.married=!0,a.relationSeed=g,g.relationSeed=a,"undefined"==typeof g.totalChildren&&(g.totalChildren=0),g.ageLastBear=g.age+1)}}}}if(a.married){if(a.x===Math.max(0,a.relationSeed.x-10)&&a.y===a.relationSeed.y)return;a.move(function(){var a=this,b=a.relationSeed;a.moveTo.x=Math.max(0,b.x-10),a.moveTo.y=b.y})}else a.move(!1)}}(window),function(a,b){"use strict";var e,c=a.WorldJS,d=c.prototype.Seed;e=c.prototype.Female=function(a){var c=this;a.appearance={x:13,y:0,width:13,height:20,child:{x:26,y:10,width:11,height:10}},d.call(c,a),c.IQ=(a.IQ||0)+Math.floor(4*Math.random()),c.maxChildAge=15,c.married=!1,c.totalChildren=b,c.ageLastBear=0,c.chances=a.chances||{death:[{range:[1,25],from:.02,to:.01},{range:[25,65],from:.01,to:.02},{range:[65,85],from:.02,to:.05},{range:[85,105],from:.05,to:.9}],childbirth:[{range:[15,25],from:.1,to:.25},{range:[25,50],from:.25,to:.1},{range:[50,70],from:.1,to:.001}]}},e.prototype=Object.create(d.prototype),e.prototype.contructor=e,e.prototype.tick=function(){var a=this;a.tickCount++;var b=a.actionInterval;if(a.tickCount%b===b-1){var c=a.world,d=a.age,e=a.getChance(a,"death");if(e>0&&Math.random()<e)return c.remove(a),void 0;if(a.married&&d>=a.chances.childbirth[0].range[0]&&d>a.ageLastBear){var f=a.getChance(a,"childbirth");if(f>0&&Math.random()<f){a.ageLastBear=d+1,a.totalChildren++;var g={x:a.x,y:Math.min(c.height-1-c.padding,a.y+Math.floor(a.appearance.height/2)),IQ:Math.round((a.relationSeed.IQ+a.IQ)/2)};Math.random()<.5?c.add(c.Male,g):c.add(c.Female,g)}}}a.move(!1)}}(window),function(a){"use strict";var c=a.WorldJS;c.KnowledgeData={huga:{id:"huga",name:"Hunting and gathering",description:["Live a hand-to-mouth existence by collecting food from the wild.","<ul><li>Adult +1 food / year</li><li>Food resource +10000</li></ul>"].join(""),IQ:{priority:1,gained:0,required:100},following:["fire","hula"],affectedYear:0,onAffected:function(a){a.Rules.Food.adult+=1,a.Statistic.foodResource+=1e4,a.Statistic.food<0&&(a.Statistic.foodResource+=a.Statistic.food,a.Statistic.food=0)}},fire:{id:"fire",name:"Controlling of fire",description:["Provide protection from predators and insects.","<ul><li>Death rate -20%</li></ul>","Expand human activity into the dark and colder hours of the night.","<ul><li>Base IQ +1</li></ul>","Be able to burn down forests for food that could also start changing the environment.","<ul><li>Food resource -1% / year</li></ul>"].join(""),IQ:{priority:1,gained:0,required:3e3},following:["cook","noma"],affectedYear:0,onAffected:function(a){a.Rules.ChanceIncr.death-=.2,a.Rules.baseIQ+=1,a.Rules.Food.resourceIncr-=.01}},hula:{id:"hula",name:"Hunting large animals",description:["Take more risks in hunting larger animals for more food.","<ul><li>Death rate +10%</li><li>Adult +2 food / year</li><li>Food resource +100000</li></ul>","The extinction of large animals, which is very likely to happen because of their long pregnancy, ","could completely change the ecological system.","<ul><li>Food resource -2% / year</li></ul>"].join(""),IQ:{priority:.1,gained:0,required:2e4},following:[],affectedYear:0,onAffected:function(a){a.Rules.ChanceIncr.death+=.1,a.Rules.Food.adult+=2,a.Statistic.foodResource+=1e5,a.Rules.Food.resourceIncr-=.02,a.Statistic.food<0&&(a.Statistic.foodResource+=a.Statistic.food,a.Statistic.food=0)}},noma:{id:"noma",name:"Living a nomadic lifestyle",description:["Follow the annual migration of animals and the growth cycles of plants to obtain food.","<ul><li>Food resource +1% / year</li></ul>","Prevent infectious diseases to take hold and spread.","<ul><li>Death rate -10%</li></ul>"].join(""),IQ:{priority:1,gained:0,required:5e4},following:["osea"],affectedYear:0,onAffected:function(a){a.Rules.Food.resourceIncr+=.01,a.Rules.ChanceIncr.death-=.1}},cook:{id:"cook",name:"Cooking",description:["Start eating many new things that could not be digested earlier, such as wheat, rice and potatoes.","<ul><li>Adult +1 food / year</li><li>Food resource +50000</li></ul>","Improve nutrition by cooked proteins.","<ul><li>Base IQ +1</li></ul>","Kill germs and parasites that infest food.","<ul><li>Death rate -20%</li><li>Food spoilage -10%</li></ul>"].join(""),IQ:{priority:1,gained:0,required:5e3},following:[],affectedYear:0,onAffected:function(a){a.Rules.Food.adult+=1,a.Statistic.foodResource+=5e4,a.Rules.baseIQ+=1,a.Rules.ChanceIncr.death-=.2,a.Rules.FoodSpoilage.foodDecr-=.1,a.Statistic.food<0&&(a.Statistic.foodResource+=a.Statistic.food,a.Statistic.food=0)}},goss:{id:"goss",name:"Gossiping",description:["Exchange information about what other people are doing and thinking to help them understand each other ","and could start living in larger bands.","<ul><li>Population limit: 150</li><li>Base IQ +1</li><li>Child -1 food / year</li></ul>"].join(""),IQ:{priority:1,gained:0,required:1e4},following:[],affectedYear:0,onAffected:function(a){a.Rules.Population.limit=150,a.padding=10,a.Rules.baseIQ+=1,a.Rules.Food.child-=1,a.addRandomPeople(50,20,30,5)}},spir:{id:"spir",name:"Speaking about guardian spirits of the tribe",description:["Unlike ants that know how to cooperate with large numbers of individuals based on their genetic code, ","humans don't really know how to create larger corporation effectively without basing it on imaginary stories ","that exist only in their minds.","<ul><li>Population limit 500</li><li>Base IQ +1</li><li>Child -1 food / year</li></ul>","Suffer more from infectious diseases.","<ul><li>Death rate +10%</li></ul>"].join(""),IQ:{priority:1,gained:0,required:5e4},following:[],affectedYear:0,onAffected:function(a){a.Rules.Population.limit=500,a.Rules.baseIQ+=1,a.Rules.Food.child-=1,a.Rules.ChanceIncr.death+=.1}},osea:{id:"osea",name:"Crossing the open sea",description:["Develop sailing crafts and boats to cross large stretches of open sea and start living in new remote islands or Continent.","<ul><li>Food resource +200000</li></ul>","Humans were able to adapt almost over a night to a completely new ecosystem based on what knowledge they have gained.","<ul><li>Death rate +0%</li></ul>"].join(""),IQ:{priority:.1,gained:0,required:2e5},following:[],affectedYear:0,onAffected:function(a){a.Statistic.foodResource+=2e5,a.Statistic.food<0&&(a.Statistic.foodResource+=a.Statistic.food,a.Statistic.food=0)}},coso:{id:"coso",name:"Coming soon...",description:["<p>You have been watching the ancient world from the first appearance of our ancestors to <b>the cognitive revolution</b>. ","During this time, humans gained some remarkable knowledge not only to spread all over the world but also to adapt to completely ","new ecological conditions within a very short time.</p>",'<p>For any feedback or ideas, email me at <a href="mailto: anvo4888@gmail.com">anvo4888@gmail.com</a></p>'].join(""),IQ:{priority:.1,gained:0,required:1e9},following:[],affectedYear:0,onAffected:function(){}}}}(window),function(a){"use strict";var f,c=a.$,d=a.WorldJS,e="#world-freeze-btn";d.God={setWorldInstance:function(a){f=a},freeze:function(){var a=c(e);return f.running?(f.stop(),a.html("Unfreeze")):(f.start(),a.html("Freeze")),!1},setKnowledgePriority:function(a,b,d){f.Knowledge.list[b].IQ.priority=d;var e;return e=d>1?"progress-bar":1>d?"progress-bar progress-bar-danger":"progress-bar progress-bar-info",c(a).addClass("active").siblings().removeClass("active").parents(".knowledge").find(".progress").find(".progress-bar").attr("class",e),!1},addRandomPeople:function(a){var b=0==f.Statistic.population;return f.addRandomPeople(a),(b||!f.running)&&(f.start(),c(e).html("Freeze")),!1},kill:function(a){return f.running||f.start(),f.stop(function(){for(var b=f.Tile.list,d=Math.random,g=a/100,h=0,i=b.length;i>h;h++)for(var j=b[h],k=0,l=j.length;l>k;k++){var m=j[k];m&&d()<g&&f.remove(m)}f.start(),c(e).html("Freeze")}),!1},giveFood:function(a){return f.Statistic.food+=a,!1}}}(window),function(a){"use strict";var c=a.$,d=a.WorldJS,e=d.Interface={},f={Statistic:{year:0,population:0,food:0,foodResource:0,men:0,women:0,families:0,boys:0,girls:0,IQ:0,maxIQ:0,yearMaxIQ:0,maxAge:0,yearMaxAge:0,avgIQ:0,avgAge:0,avgChildren:0},Rules:{adultFoodChange:0,childFoodChange:0,resourceIncr:0,foodSpoilage:0,deathChance:0},Knowledge:{knowledgeTrending:0,knowledgeHistory:0},Misc:{labelPopulationLimit:!1,labelNotEnoughResource:!1,labelFamine:!1}};for(var g in f)if(f.hasOwnProperty(g)){var h=f[g];for(var i in h)if(h.hasOwnProperty(i)){var j=h[i];h[i]={container:c("#world-"+i),value:j},-1!=c.inArray(i,["men","women","families","boys","girls"])&&(h[i+"-ex"]={container:c("#world-"+i+"-ex"),value:j})}}f.set=function(a,b){b!=a.value&&(a.value=b,a.container.html(b))},f.toggleLabel=function(a,b){b!=a.value&&(a.value=b,b?a.container.removeClass("hide"):a.container.addClass("hide"))},e.trendingAdded=function(a){var b,d,e,g;switch(a.IQ.priority){case.1:b="progress-bar progress-bar-danger",d="btn btn-sm btn-default active",e=g="btn btn-sm btn-default";break;case 2:b="progress-bar",g="btn btn-sm btn-default active",d=e="btn btn-sm btn-default";break;default:b="progress-bar progress-bar-info",e="btn btn-sm btn-default active",d=g="btn btn-sm btn-default"}var h="world-knowledge-"+a.id,i=['<div id="world-knowledge-',a.id,'" class="knowledge">','<div class="name">',a.name,"</div>",'<div class="description">',a.description,"</div>",'<div class="progress"><div class="',b,'"></div></div>','<div class="clearfix">','<div class="btn-group priority">','<a class="',d,'" href="#" title="Priority: low" onclick="return WorldJS.God.setKnowledgePriority(this, \'',a.id,"', 0.1);\">&bull;</a>",'<a class="',e,'" href="#" title="Priority: normal" onclick="return WorldJS.God.setKnowledgePriority(this, \'',a.id,"', 1);\">&gt;</a>",'<a class="',g,'" href="#" title="Priority: high" onclick="return WorldJS.God.setKnowledgePriority(this, \'',a.id,"', 2);\">&gt;&gt;</a>","</div>",'<div class="IQ"><span class="progress-IQ">0</span> / ',a.IQ.required," IQ</div>","</div>","</div>"].join(""),j=f.Knowledge;j.knowledgeTrending.container.append(i);var k=c("#"+h);j[a.id]={container:k,IQContainer:k.find(".progress-IQ"),barContainer:k.find(".progress-bar")}},e.trendingRemoved=function(a){var b=f.Knowledge[a.id];b.IQContainer.html(a.IQ.required),b.barContainer.width("100%"),b.container.remove(),delete f.Knowledge[a.id];var c=['<div class="knowledge">','<div class="name">',f.Statistic.year.value,": ",a.name,"</div>",'<div class="description">',a.description,"</div>","</div>"].join("");f.Knowledge.knowledgeHistory.container.prepend(c)},e.yearPassed=function(){var a=this,b=a.Statistic,d=f.Statistic;for(var g in d)if(d.hasOwnProperty(g))switch(g){case"avgIQ":var h=0==b.population?0:Math.round(b.IQ/b.population);f.set(d.avgIQ,h);break;case"avgAge":var i=0==b.die?0:Math.round(b.sumAge/b.die);f.set(d.avgAge,i);break;case"avgChildren":var j=0==b.dieMarriedFemale?0:Math.round(b.sumChildren/b.dieMarriedFemale);f.set(d.avgChildren,j);break;default:f.set(d[g],b[g]),-1!=c.inArray(g,["men","women","families","boys","girls"])&&f.set(d[g+"-ex"],b[g])}var k=a.Rules,l=f.Rules;f.set(l.deathChance,(100*k.Chance.death).toFixed()),f.set(l.adultFoodChange,k.Food.adult),f.set(l.childFoodChange,k.Food.child),f.set(l.foodSpoilage,(100*k.FoodSpoilage.foodDecr).toFixed()),f.set(l.resourceIncr,(100*k.Food.resourceIncr).toFixed());for(var m=a.Knowledge,n=0,o=m.trending.length;o>n;n++){var p=m.list[m.trending[n]],q=f.Knowledge[p.id];q.IQContainer.html(p.IQ.gained),q.barContainer.width(Math.round(100*(p.IQ.gained/p.IQ.required))+"%")}var r=f.Misc;f.toggleLabel(r.labelPopulationLimit,b.population>=k.Population.limit),f.toggleLabel(r.labelNotEnoughResource,b.foodResource<75||8==m.completed.length),f.toggleLabel(r.labelFamine,b.food<=k.Famine.unit);var s=b.year;if(30>=s)switch(s){case 10:var t=["<div>About 250,000 years ago, our ancestors began their lives in East Africa.</div>","<div>They had extraordinary large brains and the ability of walking upright.</div>"].join("");c("#world-container .guide").html(t),setTimeout(function(){c("#world-container .guide").empty()},15e3);break;case 30:var t=["<div>In trade-off they were less muscular and born prematurely.</div>","<div>Thus they evolved stronger social ties and started living in small bands.</div>"].join("");c("#world-container .guide").html(t),setTimeout(function(){c("#world-container .guide").empty()},3e4),a.addRandomPeople(25,20,30,5)}else b.population<30&&!r.labelFamine.value&&a.addRandomPeople(10,20,30,5);for(var u=[{key:"goss",value:50},{key:"spir",value:150}],n=0,o=u.length;o>n;n++){var v=u[n].key;if(b.population>=u[n].value&&!m.list[v].added){m.trending.push(v),e.trendingAdded(m.list[v]),m.list[v].added=!0;break}}if(8==m.completed.length&&(0==m.trending.length&&(m.trending.push("coso"),e.trendingAdded(m.list.coso)),0==b.population)){c("#world-freeze-btn").prop("disabled","disabled"),a.stop();var t=['<div class="lead">Thank you for playing until the very end of this game</div>',"<div>Humans have never really managed to live in harmony with nature. ","Food resources in the wild have their limit. ","In order to survive, our ancestors need to be able to self-produce food ","by planting crops and domesticating wild animals.</div>",'<div class="top-padding">It was how <b>the agricultural revolution</b> began and will be simulated</div>',"<div>in the next part of <b>World JS: Evolution Simulator</b>.</div>"].join("");c("#world-container .guide").html(t).css({bottom:90})}},c(".js-tab").each(function(){c(this).click(function(){return c(this).parent().addClass("active").siblings("li").removeClass("active"),c(this).parents(".js-tabs").find(".js-tab-content").addClass("hide"),c(c(this).attr("data-target")).removeClass("hide"),!1})}),c(".js-navbar-toggle").each(function(){c(this).click(function(){var a=c(c(this).attr("data-target"));a.hasClass("in")?a.removeClass("in"):a.addClass("in")})}),c(".js-statistic-toggle").each(function(){c(this).click(function(){var a=c("#world-statistic-container");a.is(":visible")?a.addClass("visible-lg"):a.removeClass("visible-lg")})})}(window),function(a){"use strict";var c=a.WorldJS,d=c.Interface,e=new c,f=e.Knowledge;c.God.setWorldInstance(e),f.list=c.KnowledgeData,f.trending=["huga"],d.trendingAdded(f.list.huga),f.trendingAdded=d.trendingAdded,f.trendingRemoved=d.trendingRemoved,e.yearPassedCallback=d.yearPassed,e.init("world");var g=30;e.add(e.Male,{x:10,y:10,moveTo:{x:320,y:180},age:13,moveUntilStep:9999,chances:{death:[{range:[1,g],from:0,to:0},{range:[g,60],from:.01,to:.02},{range:[60,80],from:.02,to:.05},{range:[80,100],from:.05,to:.5}],marriage:[{range:[1,g],from:1,to:1}]}}),e.add(e.Female,{x:630,y:350,moveTo:{x:320,y:180},age:13,moveUntilStep:9999,chances:{death:[{range:[1,g],from:0,to:0},{range:[g,65],from:.01,to:.02},{range:[65,85],from:.02,to:.05},{range:[85,105],from:.05,to:.5}],childbirth:[{range:[1,g],from:1,to:1}]}}),e.Rules.Population.limit=50,e.padding=50,e.start()}(window);